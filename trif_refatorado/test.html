<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste - Sistema TRIF</title>
  <style>
    body {
      font-family: system-ui;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f7fa;
    }
    .test-card {
      background: white;
      padding: 20px;
      margin: 16px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .success { border-left: 4px solid #10b981; }
    .error { border-left: 4px solid #ef4444; }
    h1 { color: #1e293b; }
    h3 { margin-top: 0; color: #1f2937; }
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>üß™ Testes do Sistema TRIF 2025</h1>
  
  <div class="test-card success">
    <h3>‚úÖ Teste 1: C√°lculo de Dano</h3>
    <p>Testando tabela oficial: Trivial vs Trivial</p>
    <div id="test1"></div>
  </div>

  <div class="test-card success">
    <h3>‚úÖ Teste 2: C√°lculo de Agressividade</h3>
    <p>Testando distribui√ß√£o de pontos por hits</p>
    <div id="test2"></div>
  </div>

  <div class="test-card success">
    <h3>‚úÖ Teste 3: Preven√ß√£o de Duplica√ß√£o</h3>
    <p>Testando se jurado pode julgar mesmo round 2x</p>
    <div id="test3"></div>
  </div>

  <div class="test-card success">
    <h3>‚úÖ Teste 4: C√°lculo Final de Partida</h3>
    <p>Testando soma de pontos dos 3 jurados em 3 rounds</p>
    <div id="test4"></div>
  </div>

  <script src="js/data.js"></script>
  <script>
    // Teste 1: Tabela de Dano
    const [pts1, pts2] = dataManager.calcularPontosDano('Trivial', 'Trivial');
    document.getElementById('test1').innerHTML = `
      <strong>Resultado:</strong> ${pts1} / ${pts2}<br>
      <strong>Esperado:</strong> 9 / 9<br>
      <strong>Status:</strong> ${pts1 === 9 && pts2 === 9 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
    `;

    // Teste 2: Agressividade
    const [agr1, agr2] = dataManager.calcularPontosAgressividade(10, 2);
    const pct = 10 / 12; // 83.3% > 70%
    document.getElementById('test2').innerHTML = `
      <strong>Hits:</strong> 10 vs 2 (${(pct * 100).toFixed(1)}%)<br>
      <strong>Resultado:</strong> ${agr1} / ${agr2}<br>
      <strong>Esperado:</strong> 4 / 1 (pois > 70%)<br>
      <strong>Status:</strong> ${agr1 === 4 && agr2 === 1 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
    `;

    // Teste 3: Preven√ß√£o de Duplica√ß√£o
    try {
      const partida = dataManager.createPartida('Robo A', 'Robo B');
      dataManager.addJulgamento(partida.id, 1, 1, {
        danoR1: 'Trivial', danoR2: 'Trivial',
        hitsR1: 5, hitsR2: 3,
        pontosDanoR1: 9, pontosDanoR2: 9,
        pontosAgrR1: 3, pontosAgrR2: 2,
        pontosR1: 12, pontosR2: 11
      });
      
      // Tenta julgar novamente
      try {
        dataManager.addJulgamento(partida.id, 1, 1, {
          danoR1: 'Trivial', danoR2: 'Trivial',
          hitsR1: 5, hitsR5: 3,
          pontosDanoR1: 9, pontosDanoR2: 9,
          pontosAgrR1: 3, pontosAgrR2: 2,
          pontosR1: 12, pontosR2: 11
        });
        document.getElementById('test3').innerHTML = '‚ùå FALHOU - Permitiu duplica√ß√£o';
      } catch (e) {
        document.getElementById('test3').innerHTML = `
          <strong>Erro capturado:</strong> ${e.message}<br>
          <strong>Status:</strong> ‚úÖ PASSOU - Duplica√ß√£o bloqueada
        `;
      }
    } catch (e) {
      document.getElementById('test3').innerHTML = `‚ùå ERRO: ${e.message}`;
    }

    // Teste 4: C√°lculo Final
    const partidaTeste = dataManager.createPartida('Destruidor', 'Aniquilador');
    
    // Jurado 1 julga 3 rounds
    for (let r = 1; r <= 3; r++) {
      dataManager.addJulgamento(partidaTeste.id, 1, r, {
        danoR1: 'Trivial', danoR2: 'Trivial',
        hitsR1: 3, hitsR2: 2,
        pontosDanoR1: 9, pontosDanoR2: 9,
        pontosAgrR1: 3, pontosAgrR2: 2,
        pontosR1: 12, pontosR2: 11
      });
    }
    
    // Jurado 2 julga 3 rounds
    for (let r = 1; r <= 3; r++) {
      dataManager.addJulgamento(partidaTeste.id, 2, r, {
        danoR1: 'Cosm√©tico', danoR2: 'Trivial',
        hitsR1: 4, hitsR2: 1,
        pontosDanoR1: 8, pontosDanoR2: 10,
        pontosAgrR1: 4, pontosAgrR2: 1,
        pontosR1: 12, pontosR2: 11
      });
    }
    
    // Jurado 3 julga 3 rounds (finaliza partida)
    for (let r = 1; r <= 3; r++) {
      dataManager.addJulgamento(partidaTeste.id, 3, r, {
        danoR1: 'Trivial', danoR2: 'Cosm√©tico',
        hitsR1: 2, hitsR2: 3,
        pontosDanoR1: 10, pontosDanoR2: 8,
        pontosAgrR1: 2, pontosAgrR2: 3,
        pontosR1: 12, pontosR2: 11
      });
    }
    
    const partidaFinal = dataManager.getPartida(partidaTeste.id);
    const totalEsperadoR1 = 12 * 9; // 12 pts por round √ó 9 julgamentos (3 jurados √ó 3 rounds)
    const totalEsperadoR2 = 11 * 9;
    
    document.getElementById('test4').innerHTML = `
      <strong>Total Destruidor:</strong> ${partidaFinal.resultado.pontosR1} pts<br>
      <strong>Total Aniquilador:</strong> ${partidaFinal.resultado.pontosR2} pts<br>
      <strong>Esperado:</strong> ${totalEsperadoR1} / ${totalEsperadoR2}<br>
      <strong>Vencedor:</strong> ${partidaFinal.resultado.vencedor}<br>
      <strong>Status:</strong> ${partidaFinal.resultado.pontosR1 === totalEsperadoR1 ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
    `;
  </script>
</body>
</html>
